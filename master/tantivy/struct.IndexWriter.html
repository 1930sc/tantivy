<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `IndexWriter` struct in crate `tantivy`."><meta name="keywords" content="rust, rustlang, rust-lang, IndexWriter"><title>tantivy::IndexWriter - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script></head><body class="rustdoc struct"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../tantivy/index.html'><img src='http://fulmicoton.com/tantivy-logo/tantivy-logo.png' alt='logo' width='100'></a><p class='location'>Struct IndexWriter</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#methods">Methods</a><div class="sidebar-links"><a href="#method.wait_merging_threads">wait_merging_threads</a><a href="#method.new_segment">new_segment</a><a href="#method.get_merge_policy">get_merge_policy</a><a href="#method.set_merge_policy">set_merge_policy</a><a href="#method.garbage_collect_files">garbage_collect_files</a><a href="#method.merge">merge</a><a href="#method.rollback">rollback</a><a href="#method.prepare_commit">prepare_commit</a><a href="#method.commit">commit</a><a href="#method.delete_term">delete_term</a><a href="#method.commit_opstamp">commit_opstamp</a><a href="#method.add_document">add_document</a></div><a class="sidebar-title" href="#synthetic-implementations">Auto Trait Implementations</a><div class="sidebar-links"><a href="#impl-Send">Send</a><a href="#impl-Sync">Sync</a></div></div><p class='location'><a href='index.html'>tantivy</a></p><script>window.sidebarCurrent = {name: 'IndexWriter', ty: 'struct', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><input class="search-input" name="search" autocomplete="off" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='in-band'>Struct <a href='index.html'>tantivy</a>::<wbr><a class="struct" href=''>IndexWriter</a></span><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#75-101' title='goto source code'>[src]</a></span></h1><div class="docblock type-decl"><pre class='rust struct'>pub struct IndexWriter { /* fields omitted */ }</pre></div><div class='docblock'><p><code>IndexWriter</code> is the user entry-point to add document to an index.</p>
<p>It manages a small number of indexing thread, as well as a shared
indexing queue.
Each indexing thread builds its own independent <code>Segment</code>, via
a <code>SegmentWriter</code> object.</p>
</div>
                    <h2 id='methods' class='small-section-header'>
                      Methods<a href='#methods' class='anchor'></a>
                    </h2>
                <h3 id='impl' class='impl'><span class='in-band'><table class='table-display'><tbody><tr><td><code>impl <a class="struct" href="../tantivy/struct.IndexWriter.html" title="struct tantivy::IndexWriter">IndexWriter</a></code><a href='#impl' class='anchor'></a></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#335-647' title='goto source code'>[src]</a></span></td></tr></tbody></table></h3><div class='impl-items'><h4 id='method.wait_merging_threads' class="method"><span id='wait_merging_threads.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.wait_merging_threads' class='fnname'>wait_merging_threads</a>(self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../tantivy/struct.Error.html" title="struct tantivy::Error">Error</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#337-360' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>The index writer</p>
</div><h4 id='method.new_segment' class="method"><span id='new_segment.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.new_segment' class='fnname'>new_segment</a>(&amp;self) -&gt; <a class="struct" href="../tantivy/struct.Segment.html" title="struct tantivy::Segment">Segment</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#375-377' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p><em>Experimental &amp; Advanced API</em> Creates a new segment.
and marks it as currently in write.</p>
<p>This method is useful only for users trying to do complex
operations, like converting an index format to another.</p>
</div><h4 id='method.get_merge_policy' class="method"><div class="important-traits"><div class='tooltip'>ⓘ<span class='tooltiptext'>Important traits for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;R&gt;</span></div><div class="content hidden"><h3 class="important">Important traits for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;R&gt;</h3><code class="content"><span class="where fmt-newline">impl&lt;R&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/std/io/trait.Read.html" title="trait std::io::Read">Read</a> for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;R&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;R: <a class="trait" href="https://doc.rust-lang.org/nightly/std/io/trait.Read.html" title="trait std::io::Read">Read</a> + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></span><span class="where fmt-newline">impl&lt;W&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/std/io/trait.Write.html" title="trait std::io::Write">Write</a> for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;W&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;W: <a class="trait" href="https://doc.rust-lang.org/nightly/std/io/trait.Write.html" title="trait std::io::Write">Write</a> + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></span><span class="where fmt-newline">impl&lt;I&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/iter/iterator/trait.Iterator.html" title="trait core::iter::iterator::Iterator">Iterator</a> for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;I&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;I: <a class="trait" href="https://doc.rust-lang.org/nightly/core/iter/iterator/trait.Iterator.html" title="trait core::iter::iterator::Iterator">Iterator</a> + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,&nbsp;</span></span><span class="where fmt-newline">    type <a href='https://doc.rust-lang.org/nightly/core/iter/iterator/trait.Iterator.html#associatedtype.Item' class="type">Item</a> = &lt;I as <a class="trait" href="https://doc.rust-lang.org/nightly/core/iter/iterator/trait.Iterator.html" title="trait core::iter::iterator::Iterator">Iterator</a>&gt;::<a class="type" href="https://doc.rust-lang.org/nightly/core/iter/iterator/trait.Iterator.html#associatedtype.Item" title="type core::iter::iterator::Iterator::Item">Item</a>;</span></code></div></div><span id='get_merge_policy.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.get_merge_policy' class='fnname'>get_merge_policy</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;<a class="trait" href="../tantivy/merge_policy/trait.MergePolicy.html" title="trait tantivy::merge_policy::MergePolicy">MergePolicy</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#433-435' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Accessor to the merge policy.</p>
</div><h4 id='method.set_merge_policy' class="method"><span id='set_merge_policy.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.set_merge_policy' class='fnname'>set_merge_policy</a>(&amp;self, merge_policy: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;<a class="trait" href="../tantivy/merge_policy/trait.MergePolicy.html" title="trait tantivy::merge_policy::MergePolicy">MergePolicy</a>&gt;)</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#438-440' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Set the merge policy.</p>
</div><h4 id='method.garbage_collect_files' class="method"><span id='garbage_collect_files.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.garbage_collect_files' class='fnname'>garbage_collect_files</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../tantivy/struct.Error.html" title="struct tantivy::Error">Error</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#451-453' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Detects and removes the files that
are not used by the index anymore.</p>
</div><h4 id='method.merge' class="method"><span id='merge.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.merge' class='fnname'>merge</a>(&amp;mut self, segment_ids: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">&amp;[</a><a class="struct" href="../tantivy/struct.SegmentId.html" title="struct tantivy::SegmentId">SegmentId</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a>) -&gt; <a class="struct" href="../futures/sync/oneshot/struct.Receiver.html" title="struct futures::sync::oneshot::Receiver">Receiver</a>&lt;<a class="struct" href="../tantivy/struct.SegmentMeta.html" title="struct tantivy::SegmentMeta">SegmentMeta</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#456-458' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Merges a given list of segments</p>
</div><h4 id='method.rollback' class="method"><span id='rollback.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.rollback' class='fnname'>rollback</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="../tantivy/struct.Error.html" title="struct tantivy::Error">Error</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#486-521' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Rollback to the last commit</p>
<p>This cancels all of the update that
happened before after the last commit.
After calling rollback, the index is in the same
state as it was after the last commit.</p>
<p>The opstamp at the last commit is returned.</p>
</div><h4 id='method.prepare_commit' class="method"><span id='prepare_commit.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.prepare_commit' class='fnname'>prepare_commit</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;PreparedCommit, <a class="struct" href="../tantivy/struct.Error.html" title="struct tantivy::Error">Error</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#544-581' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Prepares a commit.</p>
<p>Calling <code>prepare_commit()</code> will cut the indexing
queue. All pending documents will be sent to the
indexing workers. They will then terminate, regardless
of the size of their current segment and flush their
work on disk.</p>
<p>Once a commit is &quot;prepared&quot;, you can either
call</p>
<ul>
<li><code>.commit()</code>: to accept this commit</li>
<li><code>.abort()</code>: to cancel this commit.</li>
</ul>
<p>In the current implementation, <code>PreparedCommit</code> borrows
the <code>IndexWriter</code> mutably so we are guaranteed that no new
document can be added as long as it is committed or is
dropped.</p>
<p>It is also possible to add a payload to the <code>commit</code>
using this API.
See <a href="PreparedCommit.html"><code>PreparedCommit::set_payload()</code></a></p>
</div><h4 id='method.commit' class="method"><span id='commit.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.commit' class='fnname'>commit</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>, <a class="struct" href="../tantivy/struct.Error.html" title="struct tantivy::Error">Error</a>&gt;</code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#597-599' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Commits all of the pending changes</p>
<p>A call to commit blocks.
After it returns, all of the document that
were added since the last commit are published
and persisted.</p>
<p>In case of a crash or an hardware failure (as
long as the hard disk is spared), it will be possible
to resume indexing from this point.</p>
<p>Commit returns the <code>opstamp</code> of the last document
that made it in the commit.</p>
</div><h4 id='method.delete_term' class="method"><span id='delete_term.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.delete_term' class='fnname'>delete_term</a>(&amp;mut self, term: <a class="struct" href="../tantivy/struct.Term.html" title="struct tantivy::Term">Term</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#613-618' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Delete all documents containing a given term.</p>
<p>Delete operation only affects documents that
were added in previous commits, and documents
that were added previously in the same commit.</p>
<p>Like adds, the deletion itself will be visible
only after calling <code>commit()</code>.</p>
</div><h4 id='method.commit_opstamp' class="method"><span id='commit_opstamp.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.commit_opstamp' class='fnname'>commit_opstamp</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#627-629' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Returns the opstamp of the last successful commit.</p>
<p>This is, for instance, the opstamp the index will
rollback to if there is a failure like a power surge.</p>
<p>This is also the opstamp of the commit that is currently
available for searchers.</p>
</div><h4 id='method.add_document' class="method"><span id='add_document.v' class='invisible'><table class='table-display'><tbody><tr><td><code>pub fn <a href='#method.add_document' class='fnname'>add_document</a>(&amp;mut self, document: <a class="struct" href="../tantivy/struct.Document.html" title="struct tantivy::Document">Document</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></code></span></td><td><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../src/tantivy/indexer/index_writer.rs.html#641-646' title='goto source code'>[src]</a></td></tr></tbody></table></span></h4><div class='docblock'><p>Adds a document.</p>
<p>If the indexing pipeline is full, this call may block.</p>
<p>The opstamp is an increasing <code>u64</code> that can
be used by the client to align commits with its own
document queue.</p>
<p>Currently it represents the number of documents that
have been added since the creation of the index.</p>
</div></div>
                <h2 id='synthetic-implementations' class='small-section-header'>
                  Auto Trait Implementations<a href='#synthetic-implementations' class='anchor'></a>
                </h2>
                <div id='synthetic-implementations-list'>
            <h3 id='impl-Send' class='impl'><span class='in-band'><table class='table-display'><tbody><tr><td><code>impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> for <a class="struct" href="../tantivy/struct.IndexWriter.html" title="struct tantivy::IndexWriter">IndexWriter</a></code><a href='#impl-Send' class='anchor'></a></span></td><td><span class='out-of-band'></span></td></tr></tbody></table></h3><div class='impl-items'></div><h3 id='impl-Sync' class='impl'><span class='in-band'><table class='table-display'><tbody><tr><td><code>impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> for <a class="struct" href="../tantivy/struct.IndexWriter.html" title="struct tantivy::IndexWriter">IndexWriter</a></code><a href='#impl-Sync' class='anchor'></a></span></td><td><span class='out-of-band'></span></td></tr></tbody></table></h3><div class='impl-items'></div></div></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g. <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g. <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g. <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../";window.currentCrate = "tantivy";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>